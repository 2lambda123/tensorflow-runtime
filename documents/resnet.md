# ResNet50 Inference Benchmark in TFRT

<!--* freshness: {
  owner: 'donglin'
  reviewed: '2020-3-31'
} *-->

<!-- TOC -->

This test provides a realistic and large-sized model to benchmark the inference
performance of TFRT. This allows us to compare TFRT performance with the current
TensorFlow. The ResNet50 model executed in this test is same as the model used
by
[MLPerf inference benchmark](https://github.com/mlperf/inference/tree/r0.5/v0.5/classification_and_detection).
This document walks through the instructions to run the test.

## Test setup

This test has the following files:

*   [test_data/resnet50_graph_inference_tensors.btf](https://drive.google.com/file/d/1ReGkWkGlf9q48fauP-uhApRuoZFn1i8F/view?usp=sharing)
    that stores the model weights, the input and the output (generated by
    TensorFlow) in the custom [Binary Tensor Format](binary_tensor_format.md)
    (BTF).

*   [resnet50_graph_inference.mlir](https://github.com/tensorflow/runtime/blob/master/integrationtest/resnet/resnet50_graph_inference.mlir)
    that initializes the ResNet50 model in TFRT using the model weights stored
    in the resnet50_graph_inference_tensors.btf, runs one inference step using
    the input from the BTF file, and verifies that the output has the same
    numerical value as the output from TensorFlow.

## Test instructions

Since the BTF file is more than 90 MB, we can not check it into repository and
you will need to manually download it from Google Drive
[here](https://drive.google.com/file/d/1ReGkWkGlf9q48fauP-uhApRuoZFn1i8F/view?usp=sharing)
to the path
integrationtest/resnet/test_data/resnet50_graph_inference_tensors.btf.

Then you need to modify integrationtest/resnet/BUILD to un-comment the line that
contains "resnet50_graph_inference_tensors.btf" and remove the line that
contains "resnet50_graph_inference.mlir" in the `exclude` section.

Lastly, execute the command below to run the test. This test uses TFRT to run
the ResNet50 model in inference mode for one step and checks that it generates
the expected probability distribution across labels.

```shell
$ bazel test //integrationtest/resnet:resnet50_graph_inference.mlir.test
```
